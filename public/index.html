<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MyFabLab AI</title>
    <style>
        :root {
            --primary: #20808d;
            --primary-hover: #1a6670;
            --text-primary: #1a1a1a;
            --text-secondary: #666666;
            --background: #ffffff;
            --surface: #f8f9fa;
            --border: #e5e7eb;
            --border-light: #f3f4f6;
            --accent: #20808d;
            --success: #10b981;
            --error: #ef4444;
            --sidebar-width: 280px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background: var(--background);
            color: var(--text-primary);
            line-height: 1.6;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* Layout */
        .app-container {
            display: flex;
            height: 100vh;
            overflow: hidden;
        }

        /* Sidebar */
        .sidebar {
            width: 0;
            background: var(--surface);
            border-right: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            transition: width 0.3s ease;
            overflow: hidden;
        }

        .sidebar.open {
            width: var(--sidebar-width);
        }

        .sidebar-header {
            padding: 20px;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .sidebar-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .close-sidebar {
            background: none;
            border: none;
            cursor: pointer;
            color: var(--text-secondary);
            padding: 4px;
            font-size: 20px;
            line-height: 1;
        }

        .sidebar-content {
            flex: 1;
            overflow-y: auto;
            padding: 16px;
        }

        .nav-section {
            margin-bottom: 24px;
        }

        .nav-section-title {
            font-size: 12px;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 12px;
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 10px 12px;
            margin-bottom: 4px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            color: var(--text-primary);
            text-decoration: none;
            font-size: 14px;
        }

        .nav-item:hover {
            background: var(--border-light);
        }

        .nav-item.active {
            background: var(--primary);
            color: white;
        }

        .nav-icon {
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        /* Header */
        .header {
            display: flex;
            align-items: center;
            padding: 16px 24px;
            border-bottom: 1px solid var(--border);
            background: var(--background);
        }

        .menu-toggle {
            background: none;
            border: none;
            cursor: pointer;
            padding: 8px;
            margin-right: 16px;
            color: var(--text-primary);
            font-size: 20px;
            line-height: 1;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-right: auto;
        }

        .logo-text {
            font-size: 20px;
            font-weight: 600;
            color: var(--primary);
        }

        .pro-badge {
            background: var(--primary);
            color: white;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
        }

        /* Chat Area */
        .chat-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 40px 20px;
            overflow-y: auto;
        }

        .chat-area.has-messages {
            justify-content: flex-start;
            padding-top: 40px;
        }

        /* Welcome Screen */
        .welcome-container {
            text-align: center;
            max-width: 800px;
            margin: 0 auto;
        }

        .welcome-logo {
            margin-bottom: 40px;
        }

        .welcome-title {
            font-size: 32px;
            font-weight: 300;
            color: var(--text-primary);
            margin-bottom: 24px;
        }

        .model-selector-container {
            margin-bottom: 40px;
        }

        .model-selector-label {
            font-size: 14px;
            color: var(--text-secondary);
            margin-bottom: 12px;
        }

        .model-selector {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 16px 20px;
            font-size: 15px;
            color: var(--text-primary);
            cursor: pointer;
            width: 100%;
            max-width: 400px;
            text-align: left;
            display: inline-flex;
            align-items: center;
            justify-content: space-between;
            transition: all 0.2s;
        }

        .model-selector:hover {
            border-color: var(--primary);
        }

        /* Search Input */
        .search-container {
            width: 100%;
            max-width: 700px;
            margin: 0 auto;
            position: relative;
        }

        .search-input-wrapper {
            position: relative;
            background: var(--surface);
            border: 2px solid var(--border);
            border-radius: 16px;
            transition: all 0.2s;
        }

        .search-input-wrapper:focus-within {
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(32, 128, 141, 0.1);
        }

        .search-input {
            width: 100%;
            padding: 16px 20px;
            padding-right: 160px;
            border: none;
            background: none;
            font-size: 16px;
            color: var(--text-primary);
            outline: none;
        }

        .search-input::placeholder {
            color: var(--text-secondary);
        }

        .search-tools {
            position: absolute;
            right: 8px;
            top: 50%;
            transform: translateY(-50%);
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .tool-button {
            background: none;
            border: none;
            padding: 8px;
            cursor: pointer;
            color: var(--text-secondary);
            border-radius: 8px;
            transition: all 0.2s;
            position: relative;
            font-size: 18px;
            line-height: 1;
        }

        .tool-button:hover {
            background: var(--border-light);
            color: var(--text-primary);
        }

        .tool-button.active {
            color: var(--primary);
        }

        .send-button {
            background: var(--primary);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 6px;
            font-weight: 500;
            transition: all 0.2s;
            font-size: 18px;
            line-height: 1;
        }

        .send-button:hover {
            background: var(--primary-hover);
        }

        .send-button:disabled {
            background: var(--border);
            cursor: not-allowed;
        }

        /* Messages */
        .messages-container {
            width: 100%;
            max-width: 800px;
            margin: 0 auto;
        }

        .message {
            margin-bottom: 32px;
            animation: fadeInUp 0.3s ease-out;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 12px;
        }

        .message-avatar {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: 600;
        }

        .message.user .message-avatar {
            background: var(--primary);
            color: white;
        }

        .message.assistant .message-avatar {
            background: var(--surface);
            border: 1px solid var(--border);
            color: var(--text-secondary);
        }

        .message-author {
            font-weight: 600;
            color: var(--text-primary);
        }

        .message-content {
            margin-left: 44px;
            color: var(--text-primary);
            line-height: 1.6;
        }

        .message-content p {
            margin-bottom: 16px;
        }

        .message-content p:last-child {
            margin-bottom: 0;
        }

        .message-content code {
            background: var(--surface);
            padding: 2px 6px;
            border-radius: 4px;
            font-family: "SF Mono", Monaco, monospace;
            font-size: 14px;
        }

        .message-content pre {
            background: var(--surface);
            padding: 16px;
            border-radius: 8px;
            overflow-x: auto;
            margin: 16px 0;
        }

        /* Typing Indicator */
        .typing-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--text-secondary);
            font-size: 14px;
            margin-left: 44px;
        }

        .typing-dots {
            display: flex;
            gap: 4px;
        }

        .typing-dot {
            width: 8px;
            height: 8px;
            background: var(--text-secondary);
            border-radius: 50%;
            animation: typingPulse 1.4s infinite;
        }

        .typing-dot:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-dot:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes typingPulse {
            0%, 60%, 100% {
                opacity: 0.3;
                transform: scale(0.8);
            }
            30% {
                opacity: 1;
                transform: scale(1);
            }
        }

        /* Footer */
        .footer {
            padding: 20px;
            text-align: center;
            color: var(--text-secondary);
            font-size: 12px;
            border-top: 1px solid var(--border);
        }

        /* GPTs Section */
        .gpts-section {
            padding: 40px 20px;
            background: var(--surface);
            border-top: 1px solid var(--border);
        }

        .gpts-header {
            text-align: center;
            margin-bottom: 32px;
        }

        .gpts-title {
            font-size: 24px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 8px;
        }

        .gpts-subtitle {
            font-size: 14px;
            color: var(--text-secondary);
        }

        .gpts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 16px;
            max-width: 1200px;
            margin: 0 auto;
        }

        .gpt-card {
            background: var(--background);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .gpt-card:hover {
            border-color: var(--primary);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        }

        .gpt-icon {
            width: 48px;
            height: 48px;
            background: var(--surface);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            flex-shrink: 0;
        }

        .gpt-info {
            flex: 1;
        }

        .gpt-name {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .gpt-description {
            font-size: 13px;
            color: var(--text-secondary);
        }

        /* Model Dropdown */
        .model-dropdown {
            display: none;
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: var(--background);
            border: 1px solid var(--border);
            border-radius: 12px;
            margin-top: 8px;
            box-shadow: 0 4px 24px rgba(0, 0, 0, 0.1);
            max-height: 400px;
            overflow-y: auto;
            z-index: 100;
        }

        .model-dropdown.show {
            display: block;
        }

        .model-group {
            padding: 8px 0;
        }

        .model-group-title {
            padding: 8px 16px;
            font-size: 12px;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
        }

        .model-option {
            padding: 12px 16px;
            cursor: pointer;
            transition: background 0.2s;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .model-option:hover {
            background: var(--surface);
        }

        .model-option.selected {
            background: var(--surface);
            color: var(--primary);
        }

        .model-name {
            font-weight: 500;
        }

        .model-description {
            font-size: 12px;
            color: var(--text-secondary);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .sidebar {
                position: fixed;
                left: -100%;
                height: 100%;
                z-index: 1000;
                box-shadow: 4px 0 24px rgba(0, 0, 0, 0.1);
            }

            .sidebar.open {
                left: 0;
            }

            .search-tools {
                gap: 2px;
            }

            .tool-button span {
                display: none;
            }

            .welcome-title {
                font-size: 24px;
            }
        }

        /* Icons */
        .icon {
            width: 20px;
            height: 20px;
            stroke: currentColor;
            stroke-width: 2;
            fill: none;
        }

        /* Logo Text */
        .logo-text-large {
            font-size: 48px;
            font-weight: 300;
            letter-spacing: -2px;
            color: var(--primary);
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h2 class="sidebar-title">MyFabLab AI</h2>
                <button class="close-sidebar" onclick="toggleSidebar()">
                    ✕
                </button>
            </div>
            <div class="sidebar-content">
                <div class="nav-section">
                    <div class="nav-section-title">Início</div>
                    <a href="/" class="nav-item active">
                        <span class="nav-icon">○</span>
                        Descobrir
                    </a>
                    <a href="/arena" class="nav-item">
                        <span class="nav-icon">⚔️</span>
                        MMAI Arena
                    </a>
                    <a href="/premium" class="nav-item">
                        <span class="nav-icon">✨</span>
                        Premium
                    </a>
                    <a href="/admin" class="nav-item">
                        <span class="nav-icon">⚙️</span>
                        Admin
                    </a>
                </div>
                <div class="nav-section">
                    <div class="nav-section-title">Espaços</div>
                    <a href="#" class="nav-item">
                        <span class="nav-icon" style="font-weight: 600;">•</span>
                        Assistente
                    </a>
                    <a href="#" class="nav-item">
                        <span class="nav-icon" style="font-weight: 600;">•</span>
                        Acadêmico
                    </a>
                    <a href="#" class="nav-item">
                        <span class="nav-icon" style="font-weight: 600;">•</span>
                        Finanças
                    </a>
                    <a href="#" class="nav-item">
                        <span class="nav-icon" style="font-weight: 600;">•</span>
                        Esportes
                    </a>
                </div>
                <div class="nav-section">
                    <div class="nav-section-title">GPTs & Agentes</div>
                    <a href="#" class="nav-item" onclick="showGPTSection()">
                        <span class="nav-icon" style="font-weight: 600;">+</span>
                        Explorar GPTs
                    </a>
                    <a href="#" class="nav-item">
                        <span class="nav-icon" style="font-weight: 600;">★</span>
                        Meus Favoritos
                    </a>
                </div>
                <div class="nav-section">
                    <div class="nav-section-title">Biblioteca</div>
                    <div class="nav-item" style="color: var(--text-secondary); font-size: 13px;">
                        Suas conversas aparecerão aqui
                    </div>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Header -->
            <header class="header">
                <button class="menu-toggle" onclick="toggleSidebar()">
                    ☰
                </button>
                <div class="logo">
                    <span class="logo-text">MyFabLab AI</span>
                    <span class="pro-badge">Pro</span>
                </div>
            </header>

            <!-- Chat Area -->
            <div class="chat-area" id="chatArea">
                <div class="welcome-container" id="welcomeScreen">
                    <div class="welcome-logo">
                        <div class="logo-text-large">MyFabLab</div>
                    </div>
                    
                    <h1 class="welcome-title">Pergunte qualquer coisa</h1>
                    
                    <div class="model-selector-container">
                        <div class="model-selector-label">Escolha um modelo de IA</div>
                        <button class="model-selector" onclick="toggleModelDropdown()">
                            <span id="selectedModel">Llama 3.2 3B</span>
                            <span style="font-size: 12px;">▼</span>
                        </button>
                        <div class="model-dropdown" id="modelDropdown">
                            <!-- Model options will be inserted here -->
                        </div>
                    </div>

                    <div class="search-container">
                        <div class="search-input-wrapper">
                            <input 
                                type="text" 
                                class="search-input" 
                                id="searchInput"
                                placeholder="Pergunte qualquer coisa ou mencione um Espaço"
                                autofocus
                            >
                            <div class="search-tools">
                                <button class="tool-button" title="Buscar" style="font-size: 14px; font-weight: 500;">
                                    <span>Buscar</span>
                                </button>
                                <button class="tool-button" title="Anexar" style="font-size: 14px; font-weight: 500;">
                                    <span>Anexar</span>
                                </button>
                                <button class="tool-button" title="Imagem" style="font-size: 14px; font-weight: 500;">
                                    <span>Imagem</span>
                                </button>
                                <button class="send-button" id="sendButton" onclick="sendMessage()">
                                    →
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Messages Container -->
                <div class="messages-container" id="messagesContainer" style="display: none;">
                    <!-- Messages will be inserted here -->
                </div>
            </div>

            <!-- GPTs Section -->
            <section class="gpts-section" id="gptsSection">
                <div class="gpts-header">
                    <h2 class="gpts-title">GPTs & Agentes</h2>
                    <p class="gpts-subtitle">Assistentes especializados para suas tarefas</p>
                </div>
                <div class="gpts-grid">
                    <div class="gpt-card" onclick="useGPT('developer')">
                        <div class="gpt-icon">💻</div>
                        <div class="gpt-info">
                            <div class="gpt-name">Desenvolvedor Web</div>
                            <div class="gpt-description">Crie sites e aplicações modernas</div>
                        </div>
                    </div>
                    <div class="gpt-card" onclick="useGPT('writer')">
                        <div class="gpt-icon">✍️</div>
                        <div class="gpt-info">
                            <div class="gpt-name">Escritor Criativo</div>
                            <div class="gpt-description">Textos, artigos e conteúdo criativo</div>
                        </div>
                    </div>
                    <div class="gpt-card" onclick="useGPT('analyst')">
                        <div class="gpt-icon">📊</div>
                        <div class="gpt-info">
                            <div class="gpt-name">Analista de Dados</div>
                            <div class="gpt-description">Análises e visualizações de dados</div>
                        </div>
                    </div>
                    <div class="gpt-card" onclick="useGPT('designer')">
                        <div class="gpt-icon">🎨</div>
                        <div class="gpt-info">
                            <div class="gpt-name">Designer UI/UX</div>
                            <div class="gpt-description">Design de interfaces e experiências</div>
                        </div>
                    </div>
                    <div class="gpt-card" onclick="useGPT('teacher')">
                        <div class="gpt-icon">🎓</div>
                        <div class="gpt-info">
                            <div class="gpt-name">Professor</div>
                            <div class="gpt-description">Explicações didáticas e tutoriais</div>
                        </div>
                    </div>
                    <div class="gpt-card" onclick="useGPT('marketing')">
                        <div class="gpt-icon">📢</div>
                        <div class="gpt-info">
                            <div class="gpt-name">Marketing Digital</div>
                            <div class="gpt-description">Estratégias e campanhas de marketing</div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Footer -->
            <footer class="footer">
                <p>59 modelos gratuitos disponíveis</p>
            </footer>
        </main>
    </div>

    <script>
        // Configuration - usando backend seguro
        const API_URL = '/api/chat'; // Backend proxy seguro

        // Models data
        const models = [
            { group: 'Recomendados', items: [
                { id: 'meta-llama/llama-3.2-3b-instruct:free', name: 'Llama 3.2 3B', desc: 'Rápido e eficiente' },
                { id: 'google/gemini-2.0-flash-exp:free', name: 'Gemini 2.0 Flash', desc: '1M de contexto' },
                { id: 'qwen/qwen-2.5-72b-instruct:free', name: 'Qwen 2.5 72B', desc: 'Muito poderoso' }
            ]},
            { group: 'Meta Llama', items: [
                { id: 'meta-llama/llama-3.2-90b-vision-instruct:free', name: 'Llama 3.2 90B Vision', desc: 'Com visão' },
                { id: 'meta-llama/llama-3.2-11b-vision-instruct:free', name: 'Llama 3.2 11B Vision', desc: 'Com visão' },
                { id: 'meta-llama/llama-3.1-70b-instruct:free', name: 'Llama 3.1 70B', desc: 'Grande' },
                { id: 'meta-llama/llama-3.1-8b-instruct:free', name: 'Llama 3.1 8B', desc: 'Médio' },
                { id: 'meta-llama/llama-3-8b-instruct:free', name: 'Llama 3 8B', desc: 'Clássico' }
            ]},
            { group: 'Google', items: [
                { id: 'google/gemma-2-9b-it:free', name: 'Gemma 2 9B', desc: 'Novo' },
                { id: 'google/gemma-7b-it:free', name: 'Gemma 7B', desc: 'Eficiente' }
            ]},
            { group: 'Mistral', items: [
                { id: 'mistralai/mistral-7b-instruct:free', name: 'Mistral 7B', desc: 'Popular' },
                { id: 'mistralai/pixtral-12b:free', name: 'Pixtral 12B', desc: 'Com visão' }
            ]},
            { group: 'Outros', items: [
                { id: 'microsoft/phi-3-mini-128k-instruct:free', name: 'Phi 3 Mini', desc: 'Microsoft' },
                { id: 'openchat/openchat-7b:free', name: 'OpenChat 7B', desc: 'Community' },
                { id: 'inflection/inflection-3-pi', name: 'Inflection Pi', desc: 'Personal AI' }
            ]}
        ];

        // State
        let selectedModelId = 'meta-llama/llama-3.2-3b-instruct:free';
        let messages = [{
            role: 'system',
            content: 'Você é um assistente AI útil. Responda em português de forma clara e amigável.'
        }];

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            populateModelDropdown();
            setupEventListeners();
        });

        // Toggle sidebar
        function toggleSidebar() {
            document.getElementById('sidebar').classList.toggle('open');
        }

        // Toggle model dropdown
        function toggleModelDropdown() {
            document.getElementById('modelDropdown').classList.toggle('show');
        }

        // Populate model dropdown
        function populateModelDropdown() {
            const dropdown = document.getElementById('modelDropdown');
            dropdown.innerHTML = models.map(group => `
                <div class="model-group">
                    <div class="model-group-title">${group.group}</div>
                    ${group.items.map(model => `
                        <div class="model-option ${model.id === selectedModelId ? 'selected' : ''}" 
                             onclick="selectModel('${model.id}', '${model.name}')">
                            <div>
                                <div class="model-name">${model.name}</div>
                                <div class="model-description">${model.desc}</div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `).join('');
        }

        // Select model
        function selectModel(modelId, modelName) {
            selectedModelId = modelId;
            document.getElementById('selectedModel').textContent = modelName;
            toggleModelDropdown();
            populateModelDropdown();
        }

        // Setup event listeners
        function setupEventListeners() {
            const input = document.getElementById('searchInput');
            
            input.addEventListener('keydown', (e) => {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendMessage();
                }
            });

            // Close dropdown when clicking outside
            document.addEventListener('click', (e) => {
                if (!e.target.closest('.model-selector-container')) {
                    document.getElementById('modelDropdown').classList.remove('show');
                }
            });
        }

        // Add message to UI
        function addMessage(content, role = 'user') {
            const container = document.getElementById('messagesContainer');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${role}`;
            
            messageDiv.innerHTML = `
                <div class="message-header">
                    <div class="message-avatar">${role === 'user' ? 'Você' : 'AI'}</div>
                    <div class="message-author">${role === 'user' ? 'Você' : selectedModelId.split('/')[1].split('-')[0].charAt(0).toUpperCase() + selectedModelId.split('/')[1].split('-')[0].slice(1)}</div>
                </div>
                <div class="message-content">
                    <p>${content}</p>
                </div>
            `;
            
            container.appendChild(messageDiv);
            container.scrollTop = container.scrollHeight;
        }

        // Show typing indicator
        function showTyping() {
            const container = document.getElementById('messagesContainer');
            const typingDiv = document.createElement('div');
            typingDiv.id = 'typing';
            typingDiv.className = 'message assistant';
            
            typingDiv.innerHTML = `
                <div class="message-header">
                    <div class="message-avatar">AI</div>
                    <div class="message-author">${selectedModelId.split('/')[1].split('-')[0].charAt(0).toUpperCase() + selectedModelId.split('/')[1].split('-')[0].slice(1)}</div>
                </div>
                <div class="typing-indicator">
                    <div class="typing-dots">
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                    </div>
                    <span>está digitando...</span>
                </div>
            `;
            
            container.appendChild(typingDiv);
            container.scrollTop = container.scrollHeight;
        }

        // Hide typing indicator
        function hideTyping() {
            const typing = document.getElementById('typing');
            if (typing) typing.remove();
        }

        // Send message
        async function sendMessage() {
            const input = document.getElementById('searchInput');
            const content = input.value.trim();
            if (!content) return;

            // Hide welcome screen if visible
            const welcomeScreen = document.getElementById('welcomeScreen');
            const messagesContainer = document.getElementById('messagesContainer');
            const chatArea = document.getElementById('chatArea');
            
            if (welcomeScreen.style.display !== 'none') {
                welcomeScreen.style.display = 'none';
                messagesContainer.style.display = 'block';
                chatArea.classList.add('has-messages');
            }

            // Clear input
            input.value = '';
            
            // Add user message
            addMessage(content, 'user');
            messages.push({ role: 'user', content });

            // Show typing
            showTyping();

            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        model: selectedModelId,
                        messages: messages.slice(-10),
                        temperature: 0.7,
                        max_tokens: 1000
                    })
                });

                hideTyping();

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }

                const data = await response.json();
                const aiResponse = data.choices[0].message.content;
                
                addMessage(aiResponse, 'assistant');
                messages.push({ role: 'assistant', content: aiResponse });

            } catch (error) {
                hideTyping();
                addMessage('Desculpe, ocorreu um erro. Tente novamente.', 'assistant');
            }
        }

        // Show GPT section
        function showGPTSection() {
            const gptsSection = document.getElementById('gptsSection');
            gptsSection.scrollIntoView({ behavior: 'smooth' });
        }

        // Use GPT
        function useGPT(type) {
            const gptPrompts = {
                developer: "Você é um desenvolvedor web experiente. Ajude-me com programação, criação de sites e aplicações.",
                writer: "Você é um escritor criativo profissional. Ajude-me com textos, artigos e conteúdo criativo.",
                analyst: "Você é um analista de dados experiente. Ajude-me com análises, visualizações e insights de dados.",
                designer: "Você é um designer UI/UX talentoso. Ajude-me com design de interfaces e experiências do usuário.",
                teacher: "Você é um professor didático e paciente. Explique conceitos de forma clara e crie tutoriais passo a passo.",
                marketing: "Você é um especialista em marketing digital. Ajude-me com estratégias e campanhas de marketing."
            };

            // Update system message
            messages[0].content = gptPrompts[type] || messages[0].content;
            
            // Show confirmation
            const input = document.getElementById('searchInput');
            input.value = `Iniciando modo ${type === 'developer' ? 'Desenvolvedor' : type === 'writer' ? 'Escritor' : type === 'analyst' ? 'Analista' : type === 'designer' ? 'Designer' : type === 'teacher' ? 'Professor' : 'Marketing'}...`;
            input.focus();
            
            // Clear after 2 seconds
            setTimeout(() => {
                input.value = '';
            }, 2000);
        }
    </script>
</body>
</html>